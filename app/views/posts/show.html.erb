<p id="notice"><%= notice %></p>

<p>
    <strong>Title:</strong>
    <%= @post.title %>
</p>

<p>
    <strong>Content:</strong>
    <%= @post.content %>
</p>

<p>
    <strong>Person:</strong>
    <%= @post.person.name %>
</p>
<h2>Comments</h2>

<% def draw_tree(node) 
node.comments.each do |comment| %>
<li>
    <%= comment.commenter %>
    <%= form_for([@post, @post.comments.build]) do |f| %>
    <p>
        <%= f.label :commenter %><br>
        <%= f.text_field :commenter %>
    </p>
    <p>
        <%= f.label :body %><br>
        <%= f.text_area :body %>
    </p>
    <p>
        <%= f.hidden_field :comment_id, value: comment.id %>
    </p>
    <p>
        <%= f.submit %>
    </p>
    <% end %>
    <% if comment.comments.any? %>
    <ol><% draw_tree(comment) %>
</ol>
<% end %>
</li>
<%
    end; nil
  end
%>
<ul>
<% Comment.all.each do |comment| %>
<% if comment[:post_id] == @post[:id] && comment[:comment_id] == nil%>
<li>
    <%= comment.commenter %>
    <% if comment.comments.any? %>
    <ol><%= draw_tree(comment) %></ol>
    <% end %>
</li>
<%= form_for([@post, @post.comments.build]) do |f| %>
<p>
    <%= f.label :commenter %><br>
    <%= f.text_field :commenter %>
</p>
<p>
    <%= f.label :body %><br>
    <%= f.text_area :body %>
</p>
<p>

    <%= f.hidden_field :comment_id, value: comment.id %>

</p>
<p>
    <%= f.submit %>
</p>
<% end %>
<% end %>
<% end %>
</ul>

<h2>Add a comment:</h2>
<%= form_for([@post, @post.comments.new]) do |f| %>
<p>
<%= f.label :commenter %><br>
<%= f.text_field :commenter %>
</p>
<p>
<%= f.label :body %><br>
<%= f.text_area :body %>
</p>
<p>
<%= f.submit %>
</p>
<% end %>

<%= link_to 'Edit', edit_post_path(@post) %>
|
<%= link_to 'Back', posts_path %>
